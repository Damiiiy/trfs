{% extends 'exams/students/studentbase.html' %}
{% block content %} 
{%load static%}
<!--{% load custom_tags %}-->

<head>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>


</head>

{% if error  %}
<div class="alert alert-danger" role="alert">
    {{error}}
</div>
{% else %}
{% load custom_tags %}

<div class="jumbotron my-4">
  {% if error %}
    <p style="color:red; text-align:center;">{{ error }}</p>
  {% endif %}
  {% if success %}
    <p style="color:green; text-align:center;">{{ success }}</p>
  {% endif %}
  {% if exam %}
    <h2 style="text-align: center;">Course: {{ exam.subj_name }}</h2>
    <form method="post" action="{% url 'calculate-marks' %}" autocomplete="off">
         <div class="alert alert-warning text-center fixed-top py-2" style="z-index: 1050;">
             <strong>Time Remaining:</strong> <span id="timer">25:00</span>
         </div>
      {% csrf_token %}
      <input type="hidden" name="exam_id" value="{{ exam.id }}">

      {% for q in question %}
        <div class="d-flex w-100 align-items-center">
          <div class="col-auto flex-shrink-1 flex-grow-1">
            <h3>{{ forloop.counter }}. {{ q.question }}</h3>
          </div>
          <div class="col-auto">
            <h4 style="text-align: right;">[{{ q.marks }} Marks]</h4>
          </div>
        </div>
        {% for opt in option_labels %}
          <div class="form-check mx-4 d-flex align-items-center">
            <input class="form-check-input" type="radio"
                   name="question_{{ q.id }}"
                   id="{{ opt.0 }}_{{ q.id }}"
                   value="{{ opt.1 }}">
            <label class="form-check-label ml-3" for="{{ opt.0 }}_{{ q.id }}">
              {{ q|attr:opt.0 }}
            </label>
          </div>
        {% endfor %}
      {% endfor %}

      <input class="btn btn-primary btn-lg mt-4" type="submit" value="Submit Answers">
    </form>

    <script>
//const totalSeconds = 25 * 60; // 25 minutes
  const totalSeconds = 1 * 60; // 25 minutes
  let timeLeft = totalSeconds;
  const timerDisplay = document.getElementById('timer');
  const form = document.querySelector('form');

  function updateTimer() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
  }

  function startTimer() {
    updateTimer();
    const countdown = setInterval(() => {
      timeLeft--;
      updateTimer();

      if (timeLeft <= 0) {
        clearInterval(countdown);
        alert("Time is up! Submitting your answers...");
        form.submit();
      }
    }, 1000);
  }

  window.onload = startTimer;
</script>
  {% endif %}
</div>

</div>
{% endif %}
{% endblock content %}